<!doctype html>
<html lang="en">
    <head th:replace="~{fragment :: head('Product Form')}"></head>
    <script type="text/javascript">

        window.onload = function () {
            var valor = document.getElementsByClassName("valor");
            var qtd = document.getElementsByClassName("qtd");
            var total = document.getElementById("total");
            var aux = 0;
            for (i = 0; i < valor.length; i++) {
                if (parseFloat(qtd[i].value) <= 0) {
                    qtd[i].value = 1;
                }
                aux += (parseFloat(valor[i].innerHTML) * parseFloat(qtd[i].value));
            }
            total.innerHTML = aux.toFixed(2);
        };


        function mudarQuantidade(element) {
            let id = element.getAttribute("name");
            let qtd = element.value;
            window.location.href = "../../../../adicionar/carrinho/" + id + "/" + qtd + "/att";
        }
    </script>
    <body>
        <header th:replace="~{fragment :: header}"></header> 

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <div class="row">
                                <div class="col-xs-6">
                                    <h5><span class="glyphicon glyphicon-shopping-cart"></span> Shopping Cart</h5>
                                </div>
                                <div class="col-xs-6">
                                    <a type="button" class="btn btn-primary btn-sm btn-block" href="../../../home">
                                        <span class="glyphicon glyphicon-share-alt"></span> Continue shopping
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body mt-3" th:if="${@carrinhoController.carrinhoDeslogado} != null" th:each="item:${@carrinhoController.carrinhoDeslogado}">
                        <div class="row">
                            <div class="col-xs-1">
                                <img class="img-responsive" th:src="@{/imagem/{imagem}(imagem = ${item.imagens[0].img})}">
                            </div>
                            <div class="col-xs-4" >
                                <h4 class="product-name"><strong th:text="${item.nomeProduto}"></strong></h4>
                                <h4><small ></small></h4>
                            </div>
                            <div class="col-xs-6">
                                <div class="col-xs-6 text-right">
                                    <h6><label class="valor" th:text="${item.valor}"></label>x</h6>
                                </div>
                                <div class="col-xs-4">
                                    <input type="number" minlength="1" th:name="${item.id}" class="form-control input-sm qtd" th:value='${item.qtd}' onblur="window.onload();mudarQuantidade(this)">

                                </div>
                                <div class="col-xs-2">
                                    <a type="button" class="btn btn-link btn-xs" th:href="@{../../carrinho/dropItem/{id}(id = ${item.id})}">
                                        <span class="glyphicon glyphicon-trash"> </span>
                                    </a>

                                </div>
                            </div>
                        </div>                     
                    </div>
                    
                    <div th:if="${@carrinhoController.carrinhoDeslogado.size} < 1 and  ${carrinho} == Null">
                        <h2>Carrinho Vazio</h2>
                    </div>
                    <div th:if="${carrinho} != Null  and  ${carrinho.size} < 1">
                        <h2>Carrinho Vazio</h2>
                    </div>

                    <div class="mt-3" th:if="${carrinho} != null" th:each="carrinho:${carrinho}">
                        <div class="row">
                            <div class="col-xs-1">
                                <img class="img-responsive" th:src="@{/imagem/{imagem}(imagem = ${carrinho.prod.imagens[0].img})}">
                            </div>
                            <div class="col-xs-4" >
                                <h4 class="product-name"><strong th:text="${carrinho.prod.nomeProduto}"></strong></h4>
                                <h4><small ></small></h4>
                            </div>
                            <div class="col-xs-6">
                                <div class="col-xs-6 text-right">
                                    <h6><label class="valor" th:text="${carrinho.preco}"></label>x</h6>
                                </div>
                                <div class="col-xs-4">
                                    <input type="number" minlength="1" th:name="${carrinho.prod.id}" class="form-control input-sm qtd" th:value='${carrinho.qtd}' onblur="window.onload();mudarQuantidade(this)">

                                </div>
                                <div class="col-xs-2">
                                    <a type="button" class="btn btn-link btn-xs" th:href="@{../../carrinho/dropItem/{id}(id = ${carrinho.id})}">
                                        <span class="glyphicon glyphicon-trash"> </span>
                                    </a>

                                </div>
                            </div>
                        </div>     
                    </div>

                    <div class="panel-footer">
                        <div class="row text-center">
                            <div class="col-xs-9">
                                <h4 class="text-right">Total <label id='total'></label></h4>
                            </div>
                            <div class="col-xs-3">
                                <button type="button" class="btn btn-success btn-block">
                                    Checkout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>